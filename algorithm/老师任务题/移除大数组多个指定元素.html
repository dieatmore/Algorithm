<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 初始化
      const data = [];
      for (let i = 0; i < 8000000; i++) {
        number = Math.floor(Math.random() * 10000).toString();
        data.push({ id: number });
      }

      // set记录遍历
      function removeSet(data, indexs) {
        const setx = new Set();
        const result = [];
        indexs.forEach((index) => {
          setx.add(index);
        });

        for (let i = 0; i < data.length; i++) {
          if (!setx.has(i)) {
            result.push(data[i]);
          }
        }

        return result;
      }

      // map记录遍历
      function removeMap(data, indexs) {
        const mapx = new Map();
        const result = [];
        indexs.forEach((index) => {
          mapx.set(index, 1);
        });

        for (let i = 0; i < data.length; i++) {
          if (!mapx.has(i)) {
            result.push(data[i]);
          }
        }

        return result;
      }

      // 3.对象属性记录遍历
      function removeObj(data, indexs) {
        const result = [];
        const obj = {};
        indexs.forEach((index) => {
          obj[index] = 1;
        });

        for (let i = 0; i < data.length; i++) {
          if (!obj.hasOwnProperty(i)) {
            result.push(data[i]);
          }
        }
        console.log(obj);
        return result;
      }

      function timeTest() {
        const indexTest = [
          0, 100, 500, 999, 1000, 9999, 99999, 999999, 7999999,
        ];

        let setTotal = 0,
          mapTotal = 0,
          objTotal = 0;
        // 1. 预热：先执行一次，让引擎编译优化
        removeSet(data, indexTest);
        removeMap(data, indexTest);
        removeObj(data, indexTest);
        const testTimes = 15;

        // 2. 循环测试多次
        for (let i = 0; i < testTimes; i++) {
          const setStart = performance.now();
          const setResult = removeSet(data, indexTest);
          const setEnd = performance.now();
          setTotal += setEnd - setStart;

          const mapStart = performance.now();
          const mapResult = removeMap(data, indexTest);
          const mapEnd = performance.now();
          mapTotal += mapEnd - mapStart;

          const objStart = performance.now();
          const objResult = removeObj(data, indexTest);
          const objEnd = performance.now();
          objTotal += objEnd - objStart;
        }
        // 3. 计算平均耗时
        const setAvg = (setTotal / testTimes).toFixed(2);
        const mapAvg = (mapTotal / testTimes).toFixed(2);
        const objAvg = (objTotal / testTimes).toFixed(2);

        console.log(`set方法平均用时${setAvg}`);
        console.log(`map方法平均用时${mapAvg}`);
        console.log(`obj方法平均用时${objAvg}`);
      }

      timeTest();
    </script>
  </body>
</html>
